---
mode: 'agent'
description: '檢查 C#/.NET 程式碼設計模式實作並提出改進建議。'
---

# .NET/C# 設計模式檢查

檢查 ${selection} 中的 C#/.NET 程式碼設計模式實作，並針對本解決方案/專案提出改進建議。請僅提供檢查意見，不要直接修改程式碼。

## 必要設計模式

- **命令模式**：泛型基底類別（`CommandHandler<TOptions>`）、`ICommandHandler<TOptions>` 介面、`CommandHandlerOptions` 繼承、靜態 `SetupCommand(IHost host)` 方法
- **工廠模式**：複雜物件建立服務提供者整合
- **相依性注入**：主建構式語法、ArgumentNullException 檢查、介面抽象、正確服務生命週期
- **儲存庫模式**：非同步資料存取介面、連線抽象
- **提供者模式**：外部服務抽象（資料庫、AI）、明確合約、組態處理
- **資源模式**：ResourceManager 管理本地化訊息、獨立 .resx 檔（LogMessages、ErrorMessages）

## 檢查清單

- **設計模式**：識別已用模式。命令處理、工廠、提供者、儲存庫模式是否正確實作？有無缺少有益模式？
- **架構**：命名空間是否遵循 `{Core|Console|App|Service}.{Feature}`？Core/Console 專案分離是否正確？架構是否模組化且易讀？
- **.NET 最佳實踐**：主建構式、async/await 與 Task 回傳、ResourceManager 使用、結構化記錄、強型別組態？
- **GoF 模式**：命令、工廠、樣板方法、策略模式是否正確實作？
- **SOLID 原則**：單一職責、開放封閉、Liskov 替換、介面分離、相依性反轉是否違反？
- **效能**：非同步、資源釋放、ConfigureAwait(false)、平行處理機會？
- **可維護性**：關注點分離、錯誤處理一致性、組態使用正確？
- **可測試性**：相依性介面抽象、可模擬元件、非同步測試、AAA 模式相容？
- **安全性**：輸入驗證、安全憑證處理、參數化查詢、安全例外處理？
- **文件**：公開 API 有 XML 文件、參數/回傳說明、資源檔組織？
- **程式碼清晰度**：命名具領域意義、模式表達意圖明確、結構自明？
- **乾淨程式碼**：風格一致、方法/類別大小適中、複雜度低、無重複？

## 改進重點

- **命令處理**：基底類別驗證、一致錯誤處理、正確資源管理
- **工廠**：相依性組態、服務提供者整合、資源釋放模式
- **提供者**：連線管理、非同步模式、例外處理與記錄
- **組態**：資料註解、驗證屬性、安全敏感值處理
- **AI/ML 整合**：Semantic Kernel 模式、結構化輸出處理、模型組態

請針對架構與 .NET 最佳實踐提出具體、可執行的改進建議。
