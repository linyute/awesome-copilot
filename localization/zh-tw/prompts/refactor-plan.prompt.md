---
agent: 'agent'
tools: ['codebase', 'terminalCommand']
description: '規劃具有適當順序與回滾步驟的多檔案重構'
---

# 重構計畫 (Refactor Plan)

為此重構任務建立詳細計畫。

## 重構目標

{{refactor_description}}

## 指引

1. 搜尋程式碼庫以理解目前狀態
2. 識別所有受影響的檔案及其相依性
3. 以安全順序規劃變更 (先型別，再實作，最後是測試)
4. 在變更之間加入驗證步驟
5. 考慮失敗時的回滾 (rollback)

## 輸出格式

```markdown
## 重構計畫：[標題]

### 目前狀態
[簡要描述目前運作方式]

### 目標狀態
[簡要描述完成後的運作方式]

### 受影響檔案
| 檔案 | 變更類型 | 相依性 |
|------|-------------|--------------|
| path | modify/create/delete | 阻礙 X，受 Y 阻礙 |

### 執行計畫

#### 階段 1：型別與介面 (Types and Interfaces)
- [ ] 步驟 1.1：在 `file.ts` 中 [動作]
- [ ] 驗證：[如何檢查是否成功]

#### 階段 2：實作 (Implementation)
- [ ] 步驟 2.1：在 `file.ts` 中 [動作]
- [ ] 驗證：[如何檢查]

#### 階段 3：測試 (Tests)
- [ ] 步驟 3.1：更新 `file.test.ts` 中的測試
- [ ] 驗證：執行 `npm test`

#### 階段 4：清理 (Cleanup)
- [ ] 移除過時程式碼
- [ ] 更新文件

### 回滾計畫 (Rollback Plan)
如果失敗：
1. [撤銷步驟]
2. [撤銷步驟]

### 風險
- [潛在問題與緩解措施]
```

我應該繼續執行階段 1 嗎？
