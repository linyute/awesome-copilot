---
mode: 'agent'
description: '針對 Epic，根據產品需求文件產生高階技術架構的提示。'
---

# Epic 架構規格提示

## 目標

請扮演資深軟體架構師。你的任務是根據 Epic PRD，建立高階技術架構規格。此文件將指引 Epic 的開發，並概述主要元件、功能與所需技術使能。

## 情境考量

- 產品經理提供的 Epic PRD。
- 採用 **領域驅動架構** 模式，打造模組化、可擴展的應用。
- 支援 **自託管與 SaaS 部署**需求。
- 所有服務皆需 **Docker 容器化**。
- 技術棧為 **TypeScript/Next.js** 並採用 App Router。
- 採用 **Turborepo monorepo** 模式。
- API 採用 **tRPC** 型別安全。
- 認證採用 **Stack Auth**。

**注意：** 除非技術情境需要，否則請勿在輸出中撰寫程式碼，僅可用偽程式碼。

## 輸出格式

輸出應為完整的 Epic 架構規格，Markdown 格式，儲存於 `/docs/ways-of-work/plan/{epic-name}/arch.md`。

### 規格結構

#### 1. Epic 架構總覽

- 簡要說明此 Epic 的技術方案。

#### 2. 系統架構圖

請建立完整的 Mermaid 圖，展現此 Epic 的系統架構。圖中應包含：

- **使用者層**：展示不同使用者類型（網頁瀏覽器、行動應用、管理介面）如何與系統互動
- **應用層**：描繪負載平衡器、應用執行個體、認證服務（Stack Auth）
- **服務層**：包含 tRPC API、背景服務、工作流程引擎（n8n）、Epic 專屬服務
- **資料層**：展示資料庫（PostgreSQL）、向量資料庫（Qdrant）、快取層（Redis）、外部 API 整合
- **基礎架構層**：呈現 Docker 容器化與部署架構

請用清楚的子圖區分各層，並以一致的色彩標示不同元件類型，展現元件間資料流。Epic 相關的同步請求路徑與非同步處理流程皆需標示。

#### 3. 高階功能與技術使能

- 列出要建置的高階功能。
- 列出支援這些功能所需的技術使能（如新服務、函式庫、基礎架構）。

#### 4. 技術棧

- 列出主要技術、框架與函式庫。

#### 5. 技術價值

- 估算技術價值（如高、中、低），並簡要說明理由。

#### 6. T-Shirt Size 預估

- 對此 Epic 提供高階 T-Shirt Size 預估（如 S、M、L、XL）。

## 情境範本

- **Epic PRD：** [Epic PRD markdown 檔案內容]
