---
description: '建構 Java 基礎應用程式的指引'
applyTo: '**/*.java'
---

# Java 開發

## 一般指引

- 首先詢問使用者是否要在專案設定中整合靜態分析工具（SonarQube、PMD、Checkstyle）。
  若同意，請提供工具選擇與設定指引。
- 若使用者拒絕或不需靜態分析工具，則依下方最佳實踐、錯誤模式與程式碼異味預防指引繼續實作。
- 開發時主動處理程式碼異味，避免技術債累積。
- 重構時注重可讀性、可維護性與效能。
- 善用 IDE／編輯器警告與建議，及早發現常見問題。

## 最佳實踐

- **Records**：主要用於儲存資料的類別（如 DTO、不可變資料結構），**應優先用 Java Record 取代傳統類別**。
- **模式比對**：用 `instanceof` 與 `switch` 表達式的模式比對，簡化條件邏輯與型別轉換。
- **型別推斷**：區域變數宣告可用 `var` 提升可讀性，但僅限型別明確時。
- **不可變性**：優先使用不可變物件。類別與欄位盡量設為 `final`。固定資料用 `List.of()`／`Map.of()`。用 `Stream.toList()` 建立不可變清單。
- **Streams 與 Lambda**：集合處理用 Streams API 與 lambda 表達式。可用方法參考（如 `stream.map(Foo::toBar)`）。
- **Null 處理**：避免回傳或接受 `null`。可用 `Optional<T>` 處理可能不存在值，並用 `Objects` 工具方法如 `equals()`、`requireNonNull()`。

### 命名慣例

- 遵循 Google Java 風格指南：
  - 類別與介面名稱用 `UpperCamelCase`
  - 方法與變數名稱用 `lowerCamelCase`
  - 常數用 `UPPER_SNAKE_CASE`
  - 套件名稱用小寫
- 類別用名詞（如 `UserService`），方法用動詞（如 `getUserById`）。
- 避免縮寫與匈牙利命名法。

### 錯誤模式

| 規則編號 | 說明                                                 | 範例／備註                                                                                  |
| ------- | --------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| `S2095` | 資源應關閉                                          | 處理 stream、檔案、socket 等時用 try-with-resources。                                      |
| `S1698` | 物件應用 `.equals()` 比較而非 `==`                   | 尤其是字串與包裝型別。                                                                     |
| `S1905` | 移除多餘型別轉換                                    | 清理不必要或不安全的型別轉換。                                                             |
| `S3518` | 條件不應永遠為真或假                                | 注意無窮迴圈或永遠不變的 if 條件。                                                         |
| `S108`  | 移除不可達程式碼                                    | `return`、`throw` 之後的程式碼必須清理。                                                   |

## 程式碼異味

| 規則編號 | 說明                                            | 範例／備註                                                               |
| ------- | ---------------------------------------------- | ------------------------------------------------------------------------- |
| `S107`  | 方法參數不宜過多                                 | 可重構為輔助類別或用建構者模式。                                         |
| `S121`  | 移除重複程式區塊                                 | 合併邏輯至共用方法。                                                     |
| `S138`  | 方法不宜過長                                     | 複雜邏輯拆分為小型、可測試單元。                                         |
| `S3776` | 降低認知複雜度                                   | 簡化巢狀邏輯、抽取方法、避免深層 if 結構。                                |
| `S1192` | 字串常值不宜重複                                 | 用常數或 enum 取代。                                                     |
| `S1854` | 移除未使用賦值                                   | 避免死變數，請移除或重構。                                               |
| `S109`  | 魔法數字應用常數取代                             | 提升可讀性與可維護性。                                                   |
| `S1188` | catch 區塊不應空白                               | 一律記錄或有意義地處理例外。                                             |

## 建置與驗證

- 新增或修改程式碼後，請確認專案可正常建置。
- 若用 Maven，執行 `mvn clean install`。
- 若用 Gradle，執行 `./gradlew build`（Windows 可用 `gradlew.bat build`）。
- 確保所有測試皆通過。
