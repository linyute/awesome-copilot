---
description: '針對 TypeScript 5.x 和 ES2022 輸出目標的 TypeScript 開發指南'
applyTo: '**/*.ts'
---

# TypeScript 開發

> 這些指令假設專案是使用 TypeScript 5.x (或更新版本) 建構的，並編譯為 ES2022 JavaScript 基準。如果您的執行環境需要較舊的語言目標或降級轉譯，請調整指南。

## 核心意圖

- 尊重現有的架構和程式碼標準。
- 優先選擇可讀、明確的解決方案，而不是巧妙的捷徑。
- 在發明新的抽象之前，先擴展現有的抽象。
- 優先考慮可維護性和清晰度、簡短的函式和類別、乾淨的程式碼。

## 一般防護措施

- 目標是 TypeScript 5.x / ES2022，並優先使用原生功能而不是 polyfill。
- 使用純 ES 模組；絕不發出 `require`、`module.exports` 或 CommonJS 輔助函式。
- 除非另有要求，否則依賴專案的建構、lint 和測試指令碼。
- 當意圖不明顯時，請注意設計權衡。

## 專案組織

- 遵循儲存庫的資料夾和職責佈局來編寫新程式碼。
- 使用 kebab-case 檔案名稱 (例如，`user-session.ts`、`data-service.ts`)，除非另有說明。
- 當有助於發現時，將測試、型別和輔助函式放在其實作附近。
- 在新增共用工具之前，先重用或擴展它們。

## 命名與風格

- 類別、介面、列舉和型別別名使用 PascalCase；其他所有內容使用 camelCase。
- 跳過介面字首，例如 `I`；依賴描述性名稱。
- 根據其行為或領域意義命名事物，而不是實作。

## 格式與風格

- 在提交之前執行儲存庫的 lint/格式指令碼 (例如，`npm run lint`)。
- 匹配專案的縮排、引號樣式和尾隨逗號規則。
- 保持函式專注；當邏輯分支增長時，提取輔助函式。
- 在實用時，優先使用不可變資料和純函式。

## 型別系統期望

- 避免 `any` (隱式或顯式)；優先使用 `unknown` 加上縮小範圍。
- 對於即時事件和狀態機，使用辨別聯合。
- 集中共用契約，而不是重複形狀。
- 使用 TypeScript 工具型別 (例如，`Readonly`、`Partial`、`Record`) 表達意圖。

## 非同步、事件和錯誤處理

- 使用 `async/await`；使用結構化錯誤將 await 包裝在 try/catch 中。
- 及早防護邊緣情況，以避免深度巢狀。
- 透過專案的日誌記錄/遙測工具傳送錯誤。
- 透過儲存庫的通知模式顯示面向使用者的錯誤。
- 對於組態驅動的更新進行去抖動，並確定性地處置資源。

## 架構與模式

- 遵循儲存庫的依賴注入或組合模式；保持模組單一用途。
- 在連接到生命週期時，觀察現有的初始化和處置序列。
- 保持傳輸、領域和呈現層與清晰的介面解耦。
- 在新增服務時提供生命週期掛鉤 (例如，`initialize`、`dispose`) 和有針對性的測試。

## 外部整合

- 在熱路徑之外實例化用戶端，並注入它們以進行可測試性。
- 絕不硬編碼機密；從安全來源載入它們。
- 對網路或 IO 呼叫應用重試、退避和取消。
- 正規化外部回應並將錯誤映射到領域形狀。

## 安全實踐

- 使用綱要驗證器或型別守衛驗證和清理外部輸入。
- 避免動態程式碼執行和不受信任的模板呈現。
- 在呈現 HTML 之前對不受信任的內容進行編碼；使用框架轉義或受信任的型別。
- 使用參數化查詢或預準備語句來阻止注入。
- 將機密保存在安全儲存中，定期輪換它們，並請求最小權限範圍。
- 優先使用不可變流程和敏感資料的防禦性副本。
- 僅使用經過驗證的加密函式庫。
- 及時修補依賴項並監控諮詢。

## 組態與機密

- 透過共用輔助函式獲取組態，並使用綱要或專用驗證器進行驗證。
- 透過專案的安全儲存處理機密；防護 `undefined` 和錯誤狀態。
- 文件化新的組態金鑰並更新相關測試。

## UI 與 UX 元件

- 在呈現之前清理使用者或外部內容。
- 保持 UI 層薄；將繁重邏輯推送到服務或狀態管理器。
- 使用訊息或事件將 UI 與業務邏輯解耦。

## 測試期望

- 使用專案的框架和命名風格新增或更新單元測試。
- 當行為跨越模組或平台 API 時，擴展整合或端到端套件。
- 在提交之前執行有針對性的測試指令碼以獲取快速回饋。
- 避免脆弱的計時斷言；優先使用假計時器或注入時鐘。

## 效能與可靠性

- 延遲載入繁重依賴項，並在完成後處置它們。
- 將昂貴的工作推遲到使用者需要時。
- 批處理或去抖動高頻率事件以減少抖動。
- 追蹤資源生命週期以防止洩漏。

## 文件與註解

- 為公共 API 新增 JSDoc；在有幫助時包含 `@remarks` 或 `@example`。
- 編寫捕捉意圖的註解，並在重構期間移除過時的註釋。
- 在引入重要模式時更新架構或設計文件。
