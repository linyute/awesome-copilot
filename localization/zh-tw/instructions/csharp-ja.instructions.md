---
description: 'C# 應用程式建構指針 by @tsubakimoto'
applyTo: '**/*.cs'
---

# C# 應用程式開發

## C# 的指針
- 始終使用最新的 C#。目前是 C# 14 的功能。
- 為每個函式撰寫清晰簡潔的註解。

## 一般準則
- 在程式碼變更的檢閱中，只提供高度確信的建議。
- 撰寫程式碼時應遵循高維護性的實踐，例如包含解釋設計決策原因的註解。
- 處理邊緣情況並撰寫清晰的例外處理。
- 對於函式庫和外部依賴項，請在註解中明確說明其用途和目的。

## 命名規則

- 元件名稱、方法名稱、公開成員使用 PascalCase。
- 私有欄位和局部變數使用 camelCase。
- 介面名稱以 "I" 作為前綴（例如：IUserService）。

## 格式

- 應用 `.editorconfig` 中定義的程式碼格式樣式。
- 建議使用檔案範圍的命名空間宣告和單行 using 指示詞。
- 在任何程式碼區塊（if、for、while、foreach、using、try 等）的開頭大括號前換行。
- 方法的最終 return 語句應獨立一行。
- 盡可能使用模式匹配和 switch 表達式。
- 成員名稱參考使用 `nameof` 而不是字串常值。
- 為所有公開 API 建立 XML 文件註解。如果可能，也包含 `<example>` 和 `<code>`。

## 專案設定和組態

- 指導如何使用適當的模板建立新的 .NET 專案。
- 解釋每個生成的檔案和資料夾的目的，以幫助理解專案結構。
- 演示如何透過功能資料夾或領域驅動設計（DDD）進行組織。
- 演示如何透過模型、服務和資料存取層分離職責。
- 解釋 ASP.NET Core 10 中的 Program.cs 和組態系統，以及環境特定設定。

## 可空引用型別

- 變數宣告為非空，並在入口點檢查 `null`。
- 始終使用 `is null` 或 `is not null`，而不是 `== null` 或 `!= null`。
- 信任 C# 的空註釋，如果型別系統保證值為非空，則不添加不必要的空檢查。

## 資料存取模式

- 指導如何使用 Entity Framework Core 實作資料存取層。
- 解釋開發和生產中的選項（SQL Server、SQLite、In-Memory）。
- 演示儲存庫模式的實作以及其適用場景。
- 演示如何實作資料庫遷移和資料種子。
- 解釋避免常見效能問題的有效查詢模式。

## 身份驗證和授權

- 指導如何使用 JWT 承載令牌實作身份驗證。
- 解釋 ASP.NET Core 中與 OAuth 2.0 和 OpenID Connect 相關的概念。
- 演示如何實作基於角色和基於策略的授權。
- 演示與 Microsoft Entra ID（舊稱 Azure AD）的整合。
- 解釋如何一致地保護基於控制器 API 和 Minimal API。

## 驗證和錯誤處理

- 指導如何使用資料註釋和 FluentValidation 實作模型驗證。
- 解釋驗證管道以及如何自訂驗證回應。
- 演示如何使用中介軟體實作全域例外處理策略。
- 演示如何在整個 API 中建立一致的錯誤回應。
- 解釋如何實作用於標準化錯誤回應的 Problem Details（RFC 7807）。

## API 版本控制和文件

- 指導如何實作 API 版本控制策略並進行解釋。
- 演示如何實作帶有適當文件的 Swagger / OpenAPI。
- 演示如何文件化端點、參數、回應和身份驗證。
- 解釋基於控制器 API 和 Minimal API 中的版本控制。
- 指導如何建立對使用者有用的有意義的 API 文件。

## 日誌記錄和監控

- 指導如何使用 Serilog 等實作結構化日誌記錄。
- 解釋日誌級別以及何時使用它們。
- 演示與 Application Insights 的整合以進行遙測收集。
- 演示如何實作自訂遙測和相關 ID 以進行請求追蹤。
- 解釋如何監控 API 的效能、錯誤和使用模式。

## 測試

- 應用程式的關鍵路徑中務必包含測試案例。
- 指導如何建立單元測試。
- 不撰寫 "Act"、"Arrange"、"Assert" 註解。
- 遵循鄰近檔案的現有樣式（測試方法名稱和大小寫）。
- 解釋 API 端點的整合測試方法。
- 演示如何模擬依賴項以進行高效測試。
- 演示如何測試身份驗證和授權邏輯。
- 解釋將測試驅動開發（TDD）原則應用於 API 開發。

## 效能最佳化

- 指導如何實作快取策略（記憶體內、分散式、回應快取）。
- 解釋非同步程式設計模式以及其在 API 效能中的重要性。
- 演示針對大型資料集的頁面、過濾和排序。
- 演示如何實作壓縮等效能最佳化。
- 解釋如何測量和基準測試 API 效能。

## 部署和 DevOps

- 指導如何使用 .NET 內建容器支援（`dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer`）將 API 容器化。
- 解釋手動建立 Dockerfile 的方法與 .NET 容器發布功能的差異。
- 解釋 .NET 應用程式的 CI/CD 管道。
- 演示部署到 Azure App Service、Azure Container Apps 和其他託管選項。
- 演示如何實作健康檢查和就緒探測。
- 解釋每個部署階段中環境特定的組態。
