---
description: '產生 SQL 陳述式與儲存過程的指引'
applyTo: '**/*.sql'
---

# SQL 開發

## 資料庫結構產生
- 所有資料表名稱應為單數形式
- 所有欄位名稱應為單數形式
- 所有資料表都應有名為 `id` 的主鍵欄位
- 所有資料表都應有名為 `created_at` 的欄位以儲存建立時間戳
- 所有資料表都應有名為 `updated_at` 的欄位以儲存最後更新時間戳

## 資料庫結構設計
- 所有資料表都應有主鍵約束
- 所有外鍵約束都應有名稱
- 所有外鍵約束都應內嵌定義
- 所有外鍵約束都應有 `ON DELETE CASCADE` 選項
- 所有外鍵約束都應有 `ON UPDATE CASCADE` 選項
- 所有外鍵約束都應參照父表的主鍵

## SQL 程式風格
- SQL 關鍵字（SELECT, FROM, WHERE）請用大寫
- 巢狀查詢與條件請一致縮排
- 複雜邏輯請加註解說明
- 長查詢請分多行以利閱讀
- 子句順序請一致（SELECT, FROM, JOIN, WHERE, GROUP BY, HAVING, ORDER BY）

## SQL 查詢結構
- SELECT 陳述式請明確指定欄位名稱，勿用 SELECT *
- 多表查詢時請用表名或別名修飾欄位名稱
- 若可用 JOIN，請減少子查詢使用
- 請加上 LIMIT/TOP 子句以限制結果集
- 常查詢欄位請加適當索引
- WHERE 子句勿對索引欄位使用函式

## 儲存過程命名慣例
- 儲存過程名稱請加 'usp_' 前綴
- 名稱請用 PascalCase
- 名稱請具描述性，能反映用途（如 usp_GetCustomerOrders）
- 回傳多筆資料時請用複數名詞（如 usp_GetProducts）
- 回傳單筆資料時請用單數名詞（如 usp_GetProduct）

## 參數處理
- 參數請加 '@' 前綴
- 參數名稱請用 camelCase
- 選用參數請提供預設值
- 使用前請驗證參數值
- 參數請加註解說明
- 參數排列請一致（必填優先，選填後）

## 儲存過程結構
- 請加上標頭註解區塊，說明描述、參數與回傳值
- 回傳標準化錯誤碼/訊息
- 回傳結果集請保持欄位順序一致
- 狀態資訊請用 OUTPUT 參數回傳
- 暫存表請加 'tmp_' 前綴

## SQL 安全最佳實踐
- 所有查詢請參數化以防 SQL 注入
- 執行動態 SQL 時請用預備陳述式
- 請勿在 SQL 腳本中嵌入憑證
- 請妥善處理錯誤，勿暴露系統細節
- 儲存過程內請避免使用動態 SQL

## 交易管理
- 請明確啟動與提交交易
- 根據需求選用適當隔離層級
- 避免長時間交易鎖定資料表
- 大量資料操作請用批次處理
- 修改資料的儲存過程請加 SET NOCOUNT ON

---

**免責聲明**：本文件由 [GitHub Copilot](https://docs.github.com/copilot/about-github-copilot/what-is-github-copilot) 翻譯為繁體中文，因此可能包含錯誤。如發現任何不適當或錯誤的翻譯，請至 [issue](../../issues) 回報。
