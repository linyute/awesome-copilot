# DFRobot FIT0127 LCD 字元顯示器模擬規格

## 概述

此文件詳述如何在系統模擬器中**模擬 DFRobot FIT0127 LCD 字元顯示器模組**。FIT0127 是一款與 **HD44780 控制器**相容的 **16x2 字元 LCD**，常用於 6502 與微控制器麵包板系統。

其目標是實現適用於 SBC 模擬器、韌體測試與 UI 視覺化的**功能正確性**，而非電氣訊號模擬。

---

## 模組摘要

| 特性 | 數值 |
| ---------------- | ----------------------- |
| 顯示類型 | 字元 LCD |
| 解析度 | 16 欄 x 2 列 |
| 控制器 | HD44780 相容 |
| 介面 | 8 位元或 4 位元平行介面 |
| 字元矩陣 | 5x8 點 |
| 電源電壓 | 5V |

---

## 腳位定義

| 腳位 | 名稱 | 功能 |
| ---- | ----- | ---------------- |
| 1 | GND | 接地 |
| 2 | VCC | +5V |
| 3 | VO | 對比度控制 |
| 4 | RS | 暫存器選擇 (Register Select) |
| 5 | R/W | 讀取 / 寫入 |
| 6 | E | 致能 (Enable) |
| 7-14 | D0-D7 | 資料匯流排 |
| 15 | A | 背光正極 (+) |
| 16 | K | 背光負極 (-) |

---

## 邏輯暫存器

| RS | 暫存器 |
| -- | -------------------- |
| 0 | 指令暫存器 |
| 1 | 資料暫存器 |

---

## 指令集 (子集)

| 指令 | 代碼 | 描述 |
| --------------- | ----------- | ------------------------- |
| 清除顯示 | `0x01` | 清除 DDRAM，游標歸位 |
| 歸位 | `0x02` | 游標回到起始位置 |
| 進入模式設定 | `0x04-0x07` | 游標移動方向 |
| 顯示控制 | `0x08-0x0F` | 顯示、游標、閃爍開關 |
| 游標/位移 | `0x10-0x1F` | 位移游標/顯示內容 |
| 功能設定 | `0x20-0x3F` | 資料長度、行數 |
| 設定 CGRAM 位址 | `0x40-0x7F` | 自訂字元 |
| 設定 DDRAM 位址 | `0x80-0xFF` | 游標位置 |

---

## 內部記憶體模型

### DDRAM (顯示資料 RAM)

* 大小：80 位元組
* 第 1 行基底：`0x00`
* 第 2 行基底：`0x40`

模擬器映射：

```text
第 0 列：DDRAM[0x00-0x0F]
第 1 列：DDRAM[0x40-0x4F]
```

### CGRAM (字元產生器 RAM)

* 儲存最多 8 個自訂字元
* 每個字元 8 個位元組

---

## 資料寫入週期

當符合以下條件時發生寫入：

```
RS = 1
R/W = 0
E: 高 (HIGH)  低 (LOW)
```

### 模擬器行為

* 在 `E` 的下降邊緣閂鎖資料
* 根據位址模式將資料寫入 DDRAM 或 CGRAM
* 根據進入模式自動遞增或遞減位址

---

## 指令寫入週期

當符合以下條件時發生指令寫入：

```
RS = 0
R/W = 0
E: 高 (HIGH)  低 (LOW)
```

---

## 讀取週期 (選配)

讀取在愛好者系統中並不常見。

```
RS = 0/1
R/W = 1
E: 高 (HIGH)
```

模擬器可簡化處理：

* 完全忽略讀取
* 或回傳忙碌旗標 (busy flag) + 位址計數器

---

## 忙碌旗標模擬

### 真實硬體

* 忙碌旗標 = D7
* 指令執行耗時 37-1520 µs

### 模擬器選項

| 模式 | 行為 |
| ---------- | ----------------- |
| 簡化模式 | 一律就緒 (Always ready) |
| 定時模式 | 忙碌 N 個週期 |

建議預設值：**一律就緒**

---

## 電源啟動狀態

重設時：

* 顯示關閉 (OFF)
* 游標關閉 (OFF)
* DDRAM 已清除或為未定義
* 位址計數器 = 0

模擬器應：

* 清除 DDRAM
* 將游標設定為 (0,0)
* 啟用顯示

---

## 游標與顯示模型

狀態變數：

```text
cursor_row
cursor_col
display_on
cursor_on
blink_on
```

寫入後，游標會根據進入模式自動移動。

---

## 4 位元 vs 8 位元介面

### 8 位元模式

* 完整位元組在 D0-D7 上傳輸

### 4 位元模式

* 先發送高四位元 (high nibble)
* 每個位元組需要兩個致能脈衝

模擬器簡化：

* 接受完整位元組寫入
* 忽略四位元組定時

---

## 渲染模型 (模擬器 UI)

建議做法：

* 維持一個 16x2 的字元緩衝區
* 渲染 ASCII 子集
* 替換不支援的字形
* （選配）渲染自訂 CGRAM 字元

---

## 模擬器 API 模型

```c
typedef struct {
    uint8_t ddram[80];
    uint8_t cgram[64];
    uint8_t addr;
    bool display_on;
    bool cursor_on;
    bool blink_on;
    uint8_t entry_mode;
} FIT0127_LCD;
```

---

## 6502 系統中的常見接線

```
VIA 埠  LCD D4-D7 (4 位元模式)
RS  VIA 位元
E   VIA 位元
R/W  GND
```

---

## 測試檢查清單

* 清除顯示指令
* 透過 DDRAM 位址進行游標定位
* 連續字元寫入
* 換行行為
* 自訂字元顯示

---

## 參考資料

* [HD44780U Datasheet (Hitachi)](https://academy.cba.mit.edu/classes/output_devices/44780.pdf)
* [Ben Eater LCD 介面註記](https://hackaday.io/project/174128-db6502/log/181838-adventures-with-hd44780-lcd-controller)
* [Ben Eater 的 6502 電腦](https://github.com/tedkotz/be6502)
* [建置一台 6502 電腦](https://eater.net/6502)

---

## 備註

此規格刻意優先考慮**韌體可見的行為**，而非電氣準確性，使其成為以下用途的理想選擇：

* SBC 模擬器
* ROM 與監視器開發
* LCD 輸出的自動化測試
* 教學用的 CPU 專案
