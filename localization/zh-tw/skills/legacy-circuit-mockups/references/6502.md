# MOS Technology 6502 微處理器規格

## 1. 概述

**MOS Technology 6502** 是一款於 1975 年推出的 8 位元微處理器。它以低成本、高效的指令集以及在早期個人電腦與遊戲機（包括 Apple II、Commodore 64、Atari 2600、NES（Ricoh 2A03 變體）與 BBC Micro）中的廣泛應用而聞名。

---

## 2. 一般特性

| 特性 | 描述 |
| ------------- | ------------------------ |
| 資料寬度 | 8 位元 |
| 位址寬度 | 16 位元 |
| 位址空間 | 64 KB (0x0000–0xFFFF) |
| 暫存器 | A, X, Y, SP, PC, P |
| 位元組順序 | 小端序 (Little-endian) |
| 時脈速度 | ~1–3 MHz (原始 NMOS) |
| 技術 | NMOS |

---

## 3. 程式設計師可視暫存器

### 3.1 累加器 (A)

* 8 位元暫存器
* 用於算術、邏輯與資料傳輸操作

### 3.2 索引暫存器 (X, Y)

* 8 位元暫存器
* 用於索引記憶體、計數器與偏移量

### 3.3 堆疊指標 (SP)

* 8 位元暫存器
* 指向目前的堆疊位置
* 堆疊位於分頁 `$0100–$01FF`

### 3.4 程式計數器 (PC)

* 16 位元暫存器
* 持有下一個指令的位址

### 3.5 處理器狀態暫存器 (P)

| 位元 | 名稱 | 描述 |
| --: | ---- | ----------------------------- |
|   7 | N | 負數 (Negative) |
|   6 | V | 溢位 (Overflow) |
|   5 | – | 未使用（在推入堆疊時一律設定為 1） |
|   4 | B | 中斷 (Break) |
|   3 | D | 十進位模式 (Decimal Mode) |
|   2 | I | 中斷停用 (Interrupt Disable) |
|   1 | Z | 零 (Zero) |
|   0 | C | 進位 (Carry) |

---

## 4. 記憶體映射慣例

| 位址範圍 | 用途 |
| ------------- | -------------------- |
| `$0000–$00FF` | 零頁 (Zero Page) |
| `$0100–$01FF` | 硬體堆疊 |
| `$0200–$FFFF` | 程式 / 資料 / I/O |

### 4.1 中斷向量

| 向量 | 位址 | 描述 |
| ------- | ------------- | ---------------------- |
| NMI | `$FFFA–$FFFB` | 不可屏蔽中斷 (Non-maskable interrupt) |
| RESET | `$FFFC–$FFFD` | 重設向量 |
| IRQ/BRK | `$FFFE–$FFFF` | 中斷要求 |

---

## 5. 定址模式

| 模式 | 語法 | 描述 |
| ---------------- | ------------- | ----------------------- |
| 隱含 (Implied) | `CLC` | 運算元隱含在指令中 |
| 累加器 (Accumulator) | `ASL A` | 對累加器進行操作 |
| 立即 (Immediate) | `LDA #$10` | 常數值 |
| 零頁 (Zero Page) | `LDA $20` | 零頁位址 |
| 零頁索引 X | `LDA $20,X` | 經 X 索引的零頁位址 |
| 零頁索引 Y | `LDX $20,Y` | 經 Y 索引的零頁位址 |
| 絕對 (Absolute) | `LDA $1234` | 完整的 16 位元位址 |
| 絕對索引 X | `LDA $1234,X` | 經索引的絕對位址 |
| 絕對索引 Y | `LDA $1234,Y` | 經索引的絕對位址 |
| 間接 (Indirect) | `JMP ($1234)` | 基於指標的跳躍 |
| 索引間接 | `LDA ($20,X)` | 經 X 索引的指標 |
| 間接索引 | `LDA ($20),Y` | 經 Y 索引的指標 |
| 相對 (Relative) | `BEQ label` | 分支偏移量 |

---

## 6. 指令集摘要

### 6.1 載入 / 儲存

* `LDA`, `LDX`, `LDY`
* `STA`, `STX`, `STY`

### 6.2 暫存器傳輸

* `TAX`, `TAY`, `TXA`, `TYA`, `TSX`, `TXS`

### 6.3 堆疊操作

* `PHA`, `PLA`, `PHP`, `PLP`

### 6.4 算術

* `ADC` – 帶進位加法
* `SBC` – 帶借位減法

### 6.5 邏輯

* `AND`, `ORA`, `EOR`

### 6.6 位移與旋轉

* `ASL`, `LSR`, `ROL`, `ROR`

### 6.7 遞增 / 遞減

* `INC`, `INX`, `INY`
* `DEC`, `DEX`, `DEY`

### 6.8 比較

* `CMP`, `CPX`, `CPY`

### 6.9 分支

* `BEQ`, `BNE`, `BMI`, `BPL`, `BCS`, `BCC`, `BVS`, `BVC`

### 6.10 跳躍與副程式

* `JMP`, `JSR`, `RTS`, `RTI`

### 6.11 狀態旗標控制

* `CLC`, `SEC`, `CLI`, `SEI`, `CLV`, `CLD`, `SED`

### 6.12 系統控制

* `BRK`, `NOP`

---

## 7. 週期定時 (一般)

* 大多數指令在 **2–7 個週期**內執行
* 以下情況可能會增加額外週期：

  * 跨越分頁邊界
  * 執行分支跳轉

---

## 8. 十進位模式

當 **D 旗標** 設定時：

* `ADC` 與 `SBC` 使用 **BCD 算術** 運作
* 僅在 NMOS 6502 上有效（行為在 CMOS 衍生型號上有所不同）

---

## 9. 已知的硬體怪異行為 (Quirks)

* `JMP (addr)` 間接跳躍錯誤：分頁邊界回繞 (wraparound)

  * 範例：`JMP ($10FF)` 會從 `$10FF` 與 `$1000` 讀取
* 無專用的乘法或除法指令
* 堆疊固定在分頁 `$01xx`

---

## 10. 變體與衍生型號

| 變體 | 註記 |
| ------- | ----------------------------------- |
| 6502 | 原始 NMOS |
| 65C02 | CMOS，修正了錯誤，增加了指令 |
| 2A03 | NES 變體，停用了十進位模式 |
| 6510 | 增加了 I/O 埠 (Commodore 64) |

---

## 11. 程式碼範例

```asm
        LDX #$00
loop:   INX
        TXA
        STA $0200,X
        CPX #$10
        BNE loop
        BRK
```

---

## 12. 參考資料

* <https://syncopate.us/books/Synertek6502ProgrammingManual.html>
* <https://en.wikipedia.org/wiki/MOS_Technology_6502>
* <https://web.archive.org/web/20061114024257/http://www.westerndesigncenter.com/wdc/documentation/Programmanual.pdf>
* 取自 <https://wilsonminesco.com/6502primer/> 的教學節錄
  * <https://wilsonminesco.com/6502primer/LogicFamilies.html>
  * <https://wilsonminesco.com/6502primer/ClkGen.html>
  * <https://wilsonminesco.com/6502primer/RSTreqs.html>
  * <https://wilsonminesco.com/6502primer/displays.html>
  * <https://wilsonminesco.com/6502primer/debug.html>
  * <https://wilsonminesco.com/6502primer/potpourri.html>

---
